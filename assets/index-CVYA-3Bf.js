var ae=Object.defineProperty;var ie=(t,e,o)=>e in t?ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var $=(t,e,o)=>ie(t,typeof e!="symbol"?e+"":e,o);import{r as i,a as le,R as ce}from"./vendor-nf7bT_Uh.js";import{u as de,a as ue,b as he,c as fe,d as me}from"./gestures-ClaXdvwT.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();var J={exports:{}},C={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge=i,xe=Symbol.for("react.element"),pe=Symbol.for("react.fragment"),be=Object.prototype.hasOwnProperty,we=ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ye={key:!0,ref:!0,__self:!0,__source:!0};function Q(t,e,o){var s,n={},a=null,u=null;o!==void 0&&(a=""+o),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(u=e.ref);for(s in e)be.call(e,s)&&!ye.hasOwnProperty(s)&&(n[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:xe,type:t,key:a,ref:u,props:n,_owner:we.current}}C.Fragment=pe;C.jsx=Q;C.jsxs=Q;J.exports=C;var r=J.exports,M={},z=le;M.createRoot=z.createRoot,M.hydrateRoot=z.hydrateRoot;const B=(t,e)=>e.some(o=>t instanceof o);let G,K;function ve(){return G||(G=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function je(){return K||(K=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const F=new WeakMap,A=new WeakMap,S=new WeakMap;function Ne(t){const e=new Promise((o,s)=>{const n=()=>{t.removeEventListener("success",a),t.removeEventListener("error",u)},a=()=>{o(O(t.result)),n()},u=()=>{s(t.error),n()};t.addEventListener("success",a),t.addEventListener("error",u)});return S.set(e,t),e}function Pe(t){if(F.has(t))return;const e=new Promise((o,s)=>{const n=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",u),t.removeEventListener("abort",u)},a=()=>{o(),n()},u=()=>{s(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",a),t.addEventListener("error",u),t.addEventListener("abort",u)});F.set(t,e)}let U={get(t,e,o){if(t instanceof IDBTransaction){if(e==="done")return F.get(t);if(e==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return O(t[e])},set(t,e,o){return t[e]=o,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ee(t){U=t(U)}function Ee(t){return je().includes(t)?function(...e){return t.apply(W(this),e),O(this.request)}:function(...e){return O(t.apply(W(this),e))}}function ke(t){return typeof t=="function"?Ee(t):(t instanceof IDBTransaction&&Pe(t),B(t,ve())?new Proxy(t,U):t)}function O(t){if(t instanceof IDBRequest)return Ne(t);if(A.has(t))return A.get(t);const e=ke(t);return e!==t&&(A.set(t,e),S.set(e,t)),e}const W=t=>S.get(t);function Re(t,e,{blocked:o,upgrade:s,blocking:n,terminated:a}={}){const u=indexedDB.open(t,e),x=O(u);return s&&u.addEventListener("upgradeneeded",h=>{s(O(u.result),h.oldVersion,h.newVersion,O(u.transaction),h)}),o&&u.addEventListener("blocked",h=>o(h.oldVersion,h.newVersion,h)),x.then(h=>{a&&h.addEventListener("close",()=>a()),n&&h.addEventListener("versionchange",g=>n(g.oldVersion,g.newVersion,g))}).catch(()=>{}),x}const Oe=["get","getKey","getAll","getAllKeys","count"],Le=["put","add","delete","clear"],_=new Map;function X(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(_.get(e))return _.get(e);const o=e.replace(/FromIndex$/,""),s=e!==o,n=Le.includes(o);if(!(o in(s?IDBIndex:IDBObjectStore).prototype)||!(n||Oe.includes(o)))return;const a=async function(u,...x){const h=this.transaction(u,n?"readwrite":"readonly");let g=h.store;return s&&(g=g.index(x.shift())),(await Promise.all([g[o](...x),n&&h.done]))[0]};return _.set(e,a),a}ee(t=>({...t,get:(e,o,s)=>X(e,o)||t.get(e,o,s),has:(e,o)=>!!X(e,o)||t.has(e,o)}));const Ie=["continue","continuePrimaryKey","advance"],Z={},H=new WeakMap,te=new WeakMap,De={get(t,e){if(!Ie.includes(e))return t[e];let o=Z[e];return o||(o=Z[e]=function(...s){H.set(this,te.get(this)[e](...s))}),o}};async function*Ce(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const o=new Proxy(e,De);for(te.set(o,e),S.set(o,W(e));e;)yield o,e=await(H.get(o)||e.continue()),H.delete(o)}function q(t,e){return e===Symbol.asyncIterator&&B(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&B(t,[IDBIndex,IDBObjectStore])}ee(t=>({...t,get(e,o,s){return q(e,o)?Ce:t.get(e,o,s)},has(e,o){return q(e,o)||t.has(e,o)}}));const k={MAX_PHOTOS:50,SUPPORTED_FORMATS:["image/jpeg","image/jpg","image/png","image/webp","image/heic"],MAX_FILE_SIZE:50*1024*1024,DB_NAME:"PhotoWalletDB",DB_VERSION:1},L={SWIPE_THRESHOLD:50,SWIPE_VELOCITY_THRESHOLD:.3,ZOOM_MIN:.5,ZOOM_MAX:5,DOUBLE_TAP_THRESHOLD:300,SPRING_CONFIG:{tension:300,friction:30}},I={FILE_TYPE_NOT_SUPPORTED:"File type not supported. Please select JPEG, PNG, or WebP images.",FILE_TOO_LARGE:"File is too large. Maximum size is 50MB.",STORAGE_LIMIT_REACHED:"Cannot add more photos. Maximum of 50 photos allowed.",STORAGE_QUOTA_EXCEEDED:"Storage quota exceeded. Please remove some photos.",PHOTO_LOAD_FAILED:"Failed to load photo. Please try again.",INDEXEDDB_NOT_SUPPORTED:"Your browser does not support offline storage.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again."},re=t=>k.SUPPORTED_FORMATS.includes(t.type)?t.size>k.MAX_FILE_SIZE?{valid:!1,error:`File "${t.name}" is too large. Maximum size is ${Math.round(k.MAX_FILE_SIZE/(1024*1024))}MB.`}:{valid:!0}:{valid:!1,error:`File type "${t.type}" is not supported. Please select JPEG, PNG, or WebP images.`},Se=t=>new Promise((e,o)=>{const s=new Image,n=URL.createObjectURL(t);s.onload=()=>{URL.revokeObjectURL(n),e({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{URL.revokeObjectURL(n),o(new Error("Failed to load image"))},s.src=n}),Te=async t=>new Promise((e,o)=>{const s=new FileReader;s.onload=()=>{const n=new Blob([s.result],{type:t.type});e(n)},s.onerror=()=>{o(new Error("Failed to read file"))},s.readAsArrayBuffer(t)}),oe=t=>URL.createObjectURL(t),Ae=t=>{URL.revokeObjectURL(t)},_e=()=>`photo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;class Me{constructor(){$(this,"db",null)}async getDB(){return this.db||(this.db=await Re(k.DB_NAME,k.DB_VERSION,{upgrade(e){const o=e.createObjectStore("photos",{keyPath:"id"});o.createIndex("by-order","order"),o.createIndex("by-date","dateAdded")}})),this.db}async addPhoto(e){const o=await this.getDB();try{const[s,n]=await Promise.all([Te(e),Se(e).catch(()=>({width:0,height:0}))]),a=await this.getAllPhotos(),u=a.length>0?Math.max(...a.map(g=>g.order)):-1,x={id:_e(),blob:s,originalName:e.name,dateAdded:new Date,order:u+1,width:n.width,height:n.height},h={...x,dateAdded:x.dateAdded.toISOString()};return await o.add("photos",h),x}catch(s){throw new Error(`Failed to add photo: ${s instanceof Error?s.message:"Unknown error"}`)}}async removePhoto(e){const o=await this.getDB();try{await o.delete("photos",e)}catch(s){throw new Error(`Failed to remove photo: ${s instanceof Error?s.message:"Unknown error"}`)}}async getAllPhotos(){const e=await this.getDB();try{return(await e.getAllFromIndex("photos","by-order")).map(s=>({...s,dateAdded:new Date(s.dateAdded)}))}catch(o){throw new Error(`Failed to get photos: ${o instanceof Error?o.message:"Unknown error"}`)}}async updatePhotoOrder(e){const o=await this.getDB();try{const s=o.transaction("photos","readwrite");for(const n of e){const a={...n,dateAdded:n.dateAdded.toISOString()};await s.store.put(a)}await s.done}catch(s){throw new Error(`Failed to update photo order: ${s instanceof Error?s.message:"Unknown error"}`)}}async clearAllPhotos(){const e=await this.getDB();try{await e.clear("photos")}catch(o){throw new Error(`Failed to clear photos: ${o instanceof Error?o.message:"Unknown error"}`)}}async getStorageInfo(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{used:e.usage||0,quota:e.quota||0}}return{used:0,quota:0}}}const D=new Me,Be=()=>{const[t,e]=i.useState({photos:[],currentView:"home",currentPhotoIndex:0,isLoading:!0,error:null,isInstallable:!1,isOffline:!1}),o=i.useCallback(async()=>{try{e(m=>({...m,isLoading:!0,error:null}));const l=(await D.getAllPhotos()).sort((m,f)=>m.order-f.order);e(m=>({...m,photos:l,currentView:l.length>0?"home":"setup",isLoading:!1}))}catch(c){e(l=>({...l,isLoading:!1,currentView:"setup",error:{type:"unknown",message:c instanceof Error?c.message:I.UNKNOWN_ERROR}}))}},[]),s=i.useCallback(async c=>{if(t.photos.length>=k.MAX_PHOTOS){e(f=>({...f,error:{type:"storage-limit",message:I.STORAGE_LIMIT_REACHED}}));return}const l=[],m=[];if(c.forEach(f=>{const w=re(f);w.valid?m.push(f):l.push({type:"file-type",message:w.error,fileName:f.name})}),t.photos.length+m.length>k.MAX_PHOTOS){const f=k.MAX_PHOTOS-t.photos.length;l.push({type:"storage-limit",message:`Can only add ${f} more photo${f!==1?"s":""}.`}),m.splice(f)}if(m.length===0){e(f=>({...f,error:l[0]||null}));return}e(f=>({...f,isLoading:!0,error:null}));try{const f=[];for(const w of m)try{const y=await D.addPhoto(w);f.push(y)}catch(y){l.push({type:"unknown",message:`Failed to add ${w.name}: ${y instanceof Error?y.message:"Unknown error"}`,fileName:w.name})}f.length>0?e(w=>{const y=[...w.photos,...f].sort((d,p)=>d.order-p.order);return{...w,photos:y,isLoading:!1,error:l.length>0?l[0]:null,currentView:"home"}}):e(w=>({...w,isLoading:!1,error:l[0]||{type:"unknown",message:I.UNKNOWN_ERROR}}))}catch(f){e(w=>({...w,isLoading:!1,error:{type:"unknown",message:f instanceof Error?f.message:I.UNKNOWN_ERROR}}))}},[t.photos.length]),n=i.useCallback(async c=>{try{await D.removePhoto(c),e(l=>({...l,photos:l.photos.filter(m=>m.id!==c)}))}catch(l){e(m=>({...m,error:{type:"unknown",message:l instanceof Error?l.message:I.UNKNOWN_ERROR}}))}},[]),a=i.useCallback(async(c,l)=>{const m=[...t.photos],[f]=m.splice(c,1);m.splice(l,0,f);const w=m.map((y,d)=>({...y,order:d}));e(y=>({...y,photos:w}));try{await D.updatePhotoOrder(w)}catch{await o(),e(d=>({...d,error:{type:"unknown",message:"Failed to save new photo order. Reloading..."}}))}},[t.photos,o]),u=i.useCallback(async()=>{try{await D.clearAllPhotos(),e(c=>({...c,photos:[],currentView:"setup"}))}catch(c){e(l=>({...l,error:{type:"unknown",message:c instanceof Error?c.message:I.UNKNOWN_ERROR}}))}},[]),x=i.useCallback(()=>{e(c=>({...c,currentView:"setup"}))},[]),h=i.useCallback(()=>{e(c=>({...c,currentView:"home"}))},[]),g=i.useCallback(c=>{e(l=>({...l,currentView:"slide",currentPhotoIndex:c}))},[]),v=i.useCallback(c=>{e(l=>({...l,currentPhotoIndex:c}))},[]),P=i.useCallback(()=>{e(c=>({...c,error:null}))},[]),N=i.useCallback(c=>{e(l=>({...l,isInstallable:c}))},[]),b=i.useCallback(c=>{e(l=>({...l,isOffline:c}))},[]);i.useEffect(()=>{o()},[o]),i.useEffect(()=>{!t.isLoading&&t.photos.length===0&&t.currentView!=="setup"&&e(c=>({...c,currentView:"setup"}))},[t.photos.length,t.currentView,t.isLoading]),i.useEffect(()=>{const c=()=>b(!1),l=()=>b(!0);return window.addEventListener("online",c),window.addEventListener("offline",l),b(!navigator.onLine),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",l)}},[b]);const j=i.useMemo(()=>({addPhotos:s,removePhoto:n,reorderPhotos:a,clearAllPhotos:u,goToSetup:x,goToHome:h,goToSlide:g,setCurrentPhotoIndex:v,clearError:P,setInstallable:N,loadPhotos:o}),[s,n,a,u,x,h,g,v,P,N,o]);return{...t,actions:j}},Fe=({onOpenSettings:t,doubleTapThreshold:e=300})=>{const o=i.useRef(0),s=i.useRef(0),n=i.useRef(null),a=i.useRef(0),x={onTouchStart:i.useCallback(g=>{const v=Date.now();v<a.current||(s.current+=1,n.current&&clearTimeout(n.current),s.current===1?n.current=setTimeout(()=>{s.current=0},e):s.current===2&&(v-o.current<e&&t(),s.current=0,n.current&&(clearTimeout(n.current),n.current=null)),o.current=v)},[t,e])},h=i.useCallback((g=1e3)=>{a.current=Date.now()+g},[]);return{bindDoubleTap:x,temporarilyDisable:h}};class Y{static async handleFileSelection(){return new Promise(e=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.multiple=!0,o.onchange=s=>{const n=s.target;e(n.files)},o.oncancel=()=>{e(null)},o.click()})}static validateFiles(e){const o=[],s=[];return Array.from(e).forEach(n=>{const a=re(n);a.valid?o.push(n):s.push({type:"file-type",message:a.error,fileName:n.name})}),{validFiles:o,errors:s}}static async requestFileSystemAccess(){if("showOpenFilePicker"in window)try{return(await window.showOpenFilePicker({types:[{description:"Images",accept:{"image/*":[".png",".gif",".jpeg",".jpg",".webp"]}}],multiple:!0})).length>0}catch(e){if(e.name==="AbortError")return!1;throw e}return!1}static isFileSystemAccessSupported(){return"showOpenFilePicker"in window}static createBlobURL(e){return URL.createObjectURL(e)}static revokeBlobURL(e){URL.revokeObjectURL(e)}}const se=i.createContext(void 0),Ue=({children:t,value:e})=>r.jsx(se.Provider,{value:e,children:t}),T=()=>{const t=i.useContext(se);if(!t)throw new Error("useAppContext must be used within an AppProvider");return t},We=()=>{const{photos:t,isLoading:e,error:o,actions:s}=T(),[n,a]=i.useState(!1),u=i.useRef(null),x=i.useCallback(()=>{var b;(b=u.current)==null||b.click()},[]),h=i.useCallback(async b=>{const j=b.target.files;if(j&&j.length>0){const{validFiles:c,errors:l}=Y.validateFiles(j);l.length>0&&console.warn("File validation errors:",l),c.length>0&&await s.addPhotos(c)}b.target&&(b.target.value="")},[s]),g=i.useCallback(b=>{b.preventDefault(),a(!0)},[]),v=i.useCallback(b=>{b.preventDefault(),a(!1)},[]),P=i.useCallback(async b=>{b.preventDefault(),a(!1);const j=b.dataTransfer.files;if(j.length>0){const{validFiles:c,errors:l}=Y.validateFiles(j);l.length>0&&console.warn("File validation errors:",l),c.length>0&&await s.addPhotos(c)}},[s]),N=t.length<k.MAX_PHOTOS;return r.jsxs("div",{className:"w-full h-full flex flex-col safe-area-inset",children:[r.jsx("div",{className:"flex items-center justify-center p-4 border-b border-gray-800",children:r.jsx("h1",{className:"text-xl font-bold text-white",children:"Photo Wallet"})}),r.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6",children:[r.jsx("input",{ref:u,type:"file",accept:"image/*",multiple:!0,onChange:h,className:"hidden","data-testid":"file-input"}),r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Photo Wallet"}),r.jsx("p",{className:"text-gray-400 text-lg",children:t.length===0?"Add photos to your wallet":`${t.length} photos added`})]}),N?r.jsx("div",{className:`
            relative w-full max-w-md h-64 border-2 border-dashed rounded-lg
            transition-all duration-200 cursor-pointer
            ${n?"border-blue-400 bg-blue-400/10":"border-gray-600 hover:border-gray-500"}
            ${e?"pointer-events-none opacity-50":""}
          `,onDragOver:g,onDragLeave:v,onDrop:P,onClick:x,children:r.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-6 text-center",children:[r.jsx("div",{className:"mb-4",children:r.jsx("svg",{className:"w-12 h-12 text-gray-400 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),e?r.jsxs("div",{className:"text-white",children:[r.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full mx-auto mb-2"}),r.jsx("p",{children:"Adding photos..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("p",{className:"text-white text-lg font-medium mb-2",children:n?"Drop photos here":"Add Photos"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Tap here or drag and drop"})]})]})}):r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),r.jsx("p",{className:"text-white text-lg font-medium mb-2",children:"Wallet Full"}),r.jsx("p",{className:"text-gray-400",children:"Remove some photos to add new ones."})]}),o&&r.jsx("div",{className:"mt-6 w-full max-w-md",children:r.jsxs("div",{className:"bg-red-500/20 border border-red-500 rounded p-3 mb-2",children:[r.jsx("p",{className:"text-red-200 text-sm",children:o.message}),o.fileName&&r.jsxs("p",{className:"text-red-300 text-xs mt-1",children:["File: ",o.fileName]})]})}),r.jsx("div",{className:"mt-8 text-center",children:r.jsxs("p",{className:"text-gray-500 text-sm",children:["Supports JPEG, PNG, WebP images",r.jsx("br",{}),"Maximum file size: 50MB each"]})})]})]})},He=()=>{const{photos:t,actions:e}=T(),[o,s]=i.useState([]),[n,a]=i.useState(null),[u,x]=i.useState(null),[h,g]=i.useState(!1),v=i.useRef(null),P=i.useMemo(()=>t.map(d=>({...d,objectURL:oe(d.blob)})),[t]);i.useEffect(()=>(s(P),()=>{P.forEach(d=>{try{Ae(d.objectURL)}catch{}})}),[P]);const N=d=>{e.goToSlide(d)},b=d=>{const p=Array.from(d.target.files||[]);p.length>0&&e.addPhotos(p)},j=(d,p)=>{d.stopPropagation(),a(p)},c=()=>{n&&(e.removePhoto(n),a(null))},l=()=>{a(null)},m=(d,p)=>{x(p),d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/html","")},f=d=>{d.preventDefault(),d.dataTransfer.dropEffect="move"},w=(d,p)=>{d.preventDefault(),u!==null&&u!==p&&e.reorderPhotos(u,p),x(null)},y=()=>{x(null)};return t.length===0?r.jsxs("div",{className:"w-full h-full flex flex-col safe-area-inset",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[r.jsx("h2",{className:"text-xl font-bold text-white",children:"Photo Wallet"}),r.jsx("div",{})]}),r.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-20 h-20 bg-gray-800 rounded-lg flex items-center justify-center mb-4",children:r.jsx("svg",{className:"w-10 h-10 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})})}),r.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"No Photos Yet"}),r.jsx("p",{className:"text-gray-400 mb-6",children:"Add some photos to get started"}),r.jsx("input",{ref:v,type:"file",accept:"image/*",multiple:!0,onChange:b,className:"hidden"}),r.jsx("button",{onClick:()=>{var d;return(d=v.current)==null?void 0:d.click()},className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors",children:"Add Photos"})]})})]}):r.jsxs("div",{className:"w-full h-full flex flex-col safe-area-inset",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[r.jsxs("h2",{className:"text-xl font-bold text-white",children:["Photo Wallet (",t.length,")"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>{var d;return(d=v.current)==null?void 0:d.click()},className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Add Photos",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),r.jsx("button",{onClick:()=>g(!h),className:"p-2 text-gray-400 hover:text-white transition-colors",title:"Settings",children:r.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),r.jsx("input",{ref:v,type:"file",accept:"image/*",multiple:!0,onChange:b,className:"hidden"}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:o.map((d,p)=>r.jsxs("div",{className:`
                relative aspect-square rounded-lg overflow-hidden cursor-pointer
                transform transition-all duration-200 hover:scale-105 group
                ${u===p?"opacity-50 scale-95":""}
              `,onClick:()=>N(p),draggable:!0,onDragStart:E=>m(E,p),onDragOver:f,onDrop:E=>w(E,p),onDragEnd:y,children:[r.jsx("img",{src:d.objectURL,alt:d.originalName,className:"w-full h-full object-cover",loading:"lazy"}),r.jsx("div",{className:"absolute top-2 right-2 opacity-0 hover:opacity-100 transition-opacity pointer-events-none group-hover:pointer-events-auto",children:r.jsx("button",{onClick:E=>j(E,d.id),className:"w-8 h-8 bg-red-600 hover:bg-red-700 rounded-full flex items-center justify-center transition-colors pointer-events-auto",children:r.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})}),r.jsx("div",{className:"absolute bottom-2 left-2 text-xs text-white bg-black bg-opacity-50 px-2 py-1 rounded",children:p+1})]},d.id))})}),r.jsx("div",{className:"p-4 border-t border-gray-800 flex justify-center",children:r.jsx("button",{onClick:()=>e.goToSlide(0),disabled:t.length===0,className:"w-16 h-16 bg-green-600 hover:bg-green-700 disabled:bg-gray-700 disabled:text-gray-500 text-white rounded-full flex items-center justify-center transition-colors",children:r.jsx("svg",{className:"w-8 h-8 ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{d:"M8 5v14l11-7z"})})})}),h&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 max-w-sm w-full",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-bold text-white",children:"Settings"}),r.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("button",{onClick:()=>{e.clearAllPhotos(),g(!1)},className:"w-full bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Clear All Photos"}),r.jsx("button",{onClick:()=>g(!1),className:"w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Close"})]})]})}),n&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 max-w-sm w-full",children:[r.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Delete Photo?"}),r.jsx("p",{className:"text-gray-400 mb-6",children:"This action cannot be undone. The photo will be permanently removed from your wallet."}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:l,className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 rounded transition-colors",children:"Cancel"}),r.jsx("button",{onClick:c,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-2 rounded transition-colors",children:"Delete"})]})]})})]})},Ve=({onSwipe:t,onDoubleTap:e,initialScale:o=1,maxScale:s=L.ZOOM_MAX,minScale:n=L.ZOOM_MIN}={})=>{const[a,u]=i.useState(!1),x=i.useRef(0),[{x:h,y:g,scale:v,rotation:P},N]=de(()=>({x:0,y:0,scale:o,rotation:0,config:L.SPRING_CONFIG})),b=i.useCallback(()=>{N.start({x:0,y:0,scale:o,rotation:0}),u(!1)},[N,o]),j=i.useCallback((f,w=0,y=0)=>{const d=Math.min(Math.max(f,n),s);N.start({scale:d,x:w,y}),u(d>o)},[N,o,s,n]),c=ue(({offset:[f,w],movement:[y],velocity:[d],direction:[p],cancel:E,tap:ne,memo:R})=>{if(ne){const V=Date.now();V-x.current<L.DOUBLE_TAP_THRESHOLD&&(e?e():a?b():j(2,0,0)),x.current=V;return}if(R||(R={x:h.get(),y:g.get(),scale:v.get()}),a)N.start({x:R.x+f/R.scale,y:R.y+w/R.scale,immediate:!0});else if(Math.abs(y)>L.SWIPE_THRESHOLD&&Math.abs(d)>L.SWIPE_VELOCITY_THRESHOLD)return t&&t(p>0?"right":"left"),E(),R;return R},{axis:a?void 0:"x",bounds:a?{left:-200,right:200,top:-200,bottom:200}:void 0,rubberband:!0}),l=he(({offset:[f,w],origin:[y,d],memo:p})=>{p||(p={x:h.get(),y:g.get(),scale:v.get()});const E=Math.min(Math.max(f*p.scale,n),s);return N.start({scale:E,x:p.x+(y-window.innerWidth/2)/E,y:p.y+(d-window.innerHeight/2)/E,rotation:p.scale>1?w:0,immediate:!0}),u(E>o),p},{scaleBounds:{min:n,max:s},rubberband:!0}),m=fe(({delta:[,f],ctrlKey:w})=>{if(!w)return;const y=v.get(),d=1+Math.abs(f)*.01,p=f<0?y*d:y/d;j(p)},{preventDefault:!0});return{bind:{...c(),...l(),...m()},style:{transform:h.to([0,1],[0,1]).to(f=>`translate3d(${f}px, ${g.get()}px, 0) scale(${v.get()}) rotate(${P.get()}deg)`)},state:{x:h.get(),y:g.get(),scale:v.get(),rotation:P.get()},isZoomed:a,resetTransform:b,zoomTo:j}},$e=()=>{const{photos:t,currentPhotoIndex:e,actions:o}=T(),[s,n]=i.useState(e),[a,u]=i.useState([]);i.useEffect(()=>{const m=t.map(f=>({...f,objectURL:oe(f.blob)}));u(m)},[t]);const x=a[s],h=i.useCallback(()=>{const m=s>0?s-1:t.length-1;n(m),o.setCurrentPhotoIndex(m)},[s,t.length,o]),g=i.useCallback(()=>{const m=s<t.length-1?s+1:0;n(m),o.setCurrentPhotoIndex(m)},[s,t.length,o]),v=i.useCallback(m=>{m==="left"?g():h()},[g,h]),P=i.useCallback(()=>{o.goToHome()},[o]),{bind:N,style:b,resetTransform:j}=Ve({onSwipe:v,onDoubleTap:P}),c=i.useCallback(()=>{g()},[g]),l=i.useCallback(m=>{switch(m.key){case"ArrowLeft":h();break;case"ArrowRight":g();break;case"Escape":m.preventDefault(),m.stopPropagation(),o.goToHome();break}},[h,g,o]);return i.useEffect(()=>(window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)),[l]),i.useEffect(()=>{n(e)},[e]),i.useEffect(()=>{j()},[s,j]),t.length>0&&a.length===0?r.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-white text-center",children:[r.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-4"}),r.jsx("p",{children:"Loading photo..."})]})}):t.length===0?r.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-white text-center",children:[r.jsx("p",{children:"No photos to display"}),r.jsx("button",{onClick:()=>o.goToHome(),className:"mt-4 bg-gray-700 text-white px-4 py-2 rounded",children:"Close"})]})}):x?r.jsx("div",{className:"fixed inset-0 bg-black z-50 touch-none select-none",children:r.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",children:r.jsx(me.div,{...N,style:b,className:"will-change-transform cursor-pointer",onClick:c,children:r.jsx("img",{src:x.objectURL,alt:x.originalName,className:"max-w-full max-h-full object-contain",draggable:!1,onError:m=>{console.error("Image failed to load:",x.originalName,m)}})})})}):r.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-white text-center",children:[r.jsx("p",{children:"Error loading photo"}),r.jsx("button",{onClick:()=>o.goToHome(),className:"mt-4 bg-gray-700 text-white px-4 py-2 rounded",children:"Close"})]})})};class ze extends i.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,o){console.error("ErrorBoundary caught an error:",e,o)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"w-full h-full bg-black text-white flex flex-col items-center justify-center p-6",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx("div",{className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),r.jsx("h2",{className:"text-xl font-bold mb-2",children:"Something went wrong"}),r.jsx("p",{className:"text-gray-400 mb-6",children:"The app encountered an unexpected error. Please refresh the page to try again."}),r.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Refresh Page"}),this.state.error&&r.jsxs("details",{className:"mt-4 text-left",children:[r.jsx("summary",{className:"cursor-pointer text-gray-500 text-sm hover:text-gray-400",children:"Technical Details"}),r.jsx("pre",{className:"mt-2 p-3 bg-gray-900 rounded text-xs text-gray-300 overflow-x-auto",children:this.state.error.stack})]})]})}):this.props.children}}function Ge(){const{currentView:t,error:e,isInstallable:o,isOffline:s,actions:n}=T(),a=i.useCallback(()=>{console.log("Settings triggered")},[]),{bindDoubleTap:u}=Fe({onOpenSettings:a});i.useEffect(()=>{const h=g=>{g.preventDefault(),n.setInstallable(!0)};return window.addEventListener("beforeinstallprompt",h),()=>{window.removeEventListener("beforeinstallprompt",h)}},[n]);const x=()=>{switch(t){case"setup":return r.jsx(We,{});case"slide":return r.jsx($e,{});case"home":default:return r.jsx(He,{})}};return r.jsx(ze,{children:r.jsxs("div",{className:"w-full h-full bg-black text-white overflow-hidden select-none",children:[s&&r.jsx("div",{className:"absolute top-0 left-0 right-0 bg-yellow-600 text-black text-center py-2 text-sm font-medium z-40",children:"You're offline. The app will continue to work normally."}),o&&t!=="slide"&&r.jsxs("div",{className:"absolute top-0 left-0 right-0 bg-blue-600 text-white text-center py-2 text-sm z-40",children:[r.jsx("button",{onClick:async()=>{const h=window.deferredPrompt;if(h){h.prompt();const{outcome:g}=await h.userChoice;g==="accepted"&&n.setInstallable(!1)}},className:"underline hover:no-underline",children:"Install Photo Wallet for a better experience"}),r.jsx("button",{onClick:()=>n.setInstallable(!1),className:"ml-4 text-blue-200 hover:text-white",children:"×"})]}),r.jsx("div",{className:`w-full h-full ${s||o?"pt-10":""}`,...t==="home"?u:{},children:x()}),e&&t!=="setup"&&t!=="add"&&r.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-red-600 text-white p-4 rounded-lg shadow-lg z-50",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium",children:e.message}),e.fileName&&r.jsxs("p",{className:"text-sm text-red-200 mt-1",children:["File: ",e.fileName]})]}),r.jsx("button",{onClick:n.clearError,className:"ml-4 text-red-200 hover:text-white",children:"×"})]})})]})})}function Ke(){const t=Be();return r.jsx(Ue,{value:{currentView:t.currentView,photos:t.photos,currentPhotoIndex:t.currentPhotoIndex,isLoading:t.isLoading,error:t.error,isInstallable:t.isInstallable,isOffline:t.isOffline,actions:{goToSetup:t.actions.goToSetup,goToHome:t.actions.goToHome,goToSlide:t.actions.goToSlide,setCurrentPhotoIndex:t.actions.setCurrentPhotoIndex,clearError:t.actions.clearError,setInstallable:t.actions.setInstallable,addPhotos:t.actions.addPhotos,removePhoto:t.actions.removePhoto,reorderPhotos:t.actions.reorderPhotos,clearAllPhotos:t.actions.clearAllPhotos}},children:r.jsx(Ge,{})})}M.createRoot(document.getElementById("root")).render(r.jsx(ce.StrictMode,{children:r.jsx(Ke,{})}));
