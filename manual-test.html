<!DOCTYPE html>
<html>
<head>
    <title>Manual Photo Upload Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .status { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .info { background: #e7f3ff; color: #0066cc; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .console-output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Manual Photo Upload Test</h1>
        
        <div class="step">
            <h3>Step 1: Open Photo Wallet</h3>
            <button onclick="openPhotoWallet()">Open Photo Wallet App</button>
            <div id="step1-status" class="status info">Click the button above to open the Photo Wallet app</div>
        </div>
        
        <div class="step">
            <h3>Step 2: Create Test Images</h3>
            <button onclick="createTestImages()">Create 3 Test Images</button>
            <div id="step2-status" class="status info">Click to create test images for uploading</div>
        </div>
        
        <div class="step">
            <h3>Step 3: Test Upload Process</h3>
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Go to the Photo Wallet app (opened in Step 1)</li>
                <li>Open browser console (F12 → Console tab)</li>
                <li>Click "Add Photos" button</li>
                <li>Select the test images from your Downloads folder</li>
                <li>Watch the console for debug messages</li>
                <li>Check if images appear immediately or show as file names</li>
            </ol>
            <div id="step3-status" class="status info">Follow the instructions above</div>
        </div>
        
        <div class="step">
            <h3>Console Output (Copy from Photo Wallet app)</h3>
            <p>Copy and paste any console messages from the Photo Wallet app here:</p>
            <textarea id="console-output" class="console-output" rows="10" placeholder="Paste console output here..."></textarea>
            <button onclick="analyzeConsole()">Analyze Console Output</button>
            <div id="analysis" class="status info">Console analysis will appear here</div>
        </div>
    </div>

    <script>
        let photoWalletWindow = null;
        
        function openPhotoWallet() {
            const status = document.getElementById('step1-status');
            status.textContent = 'Opening Photo Wallet app...';
            status.className = 'status info';
            
            try {
                photoWalletWindow = window.open('http://localhost:5173/-PhotoWalletPWA/', '_blank');
                
                setTimeout(() => {
                    if (photoWalletWindow && !photoWalletWindow.closed) {
                        status.textContent = '✅ Photo Wallet app opened! Now open the browser console (F12) and proceed to Step 2.';
                        status.className = 'status success';
                    } else {
                        status.textContent = '❌ Failed to open Photo Wallet app';
                        status.className = 'status error';
                    }
                }, 1000);
            } catch (error) {
                status.textContent = `❌ Error: ${error.message}`;
                status.className = 'status error';
            }
        }
        
        function createTestImages() {
            const status = document.getElementById('step2-status');
            status.textContent = 'Creating test images...';
            status.className = 'status info';
            
            const testData = [
                { name: 'test-sunset.jpg', color: '#FF6B6B', text: 'Sunset' },
                { name: 'test-ocean.jpg', color: '#4ECDC4', text: 'Ocean' },
                { name: 'test-mountain.jpg', color: '#45B7D1', text: 'Mountain' }
            ];
            
            let completed = 0;
            
            testData.forEach((data, index) => {
                const canvas = document.createElement('canvas');
                canvas.width = 400;
                canvas.height = 300;
                const ctx = canvas.getContext('2d');
                
                // Create gradient background
                const gradient = ctx.createLinearGradient(0, 0, 400, 300);
                gradient.addColorStop(0, data.color);
                gradient.addColorStop(1, adjustColor(data.color, -30));
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 400, 300);
                
                // Add some pattern
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                for (let i = 0; i < 20; i++) {
                    ctx.fillRect(Math.random() * 400, Math.random() * 300, 8, 8);
                }
                
                // Add text
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 3;
                ctx.fillText(data.text, 200, 150);
                
                // Add file name
                ctx.font = '16px Arial';
                ctx.fillText(data.name, 200, 180);
                
                // Convert to blob and download
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = data.name;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    completed++;
                    status.textContent = `Created ${completed}/${testData.length} test images`;
                    
                    if (completed === testData.length) {
                        status.textContent = '✅ All test images created and downloaded! Check your Downloads folder.';
                        status.className = 'status success';
                    }
                }, 'image/jpeg', 0.9);
            });
        }
        
        function adjustColor(color, amount) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * amount);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
        
        function analyzeConsole() {
            const output = document.getElementById('console-output').value;
            const analysis = document.getElementById('analysis');
            
            if (!output.trim()) {
                analysis.textContent = 'Please paste console output first';
                analysis.className = 'status warning';
                return;
            }
            
            let result = 'Analysis:\n';
            
            if (output.includes('usePhotoWallet: Updating state with new photos')) {
                result += '✅ State update detected\n';
            } else {
                result += '❌ No state update detected\n';
            }
            
            if (output.includes('PhotoManager: Creating URLs for photos')) {
                result += '✅ PhotoManager creating URLs\n';
            } else {
                result += '❌ PhotoManager not creating URLs\n';
            }
            
            if (output.includes('Image loaded successfully')) {
                result += '✅ Images loading successfully\n';
            } else if (output.includes('Image failed to load')) {
                result += '❌ Images failing to load\n';
            } else {
                result += '⚠️ No image load messages found\n';
            }
            
            if (output.includes('hasBlob: true')) {
                result += '✅ Blobs are present\n';
            } else {
                result += '❌ No blobs detected\n';
            }
            
            analysis.textContent = result;
            analysis.className = 'status info';
        }
        
        // Auto-open Photo Wallet
        window.onload = function() {
            setTimeout(openPhotoWallet, 500);
        };
    </script>
</body>
</html>
